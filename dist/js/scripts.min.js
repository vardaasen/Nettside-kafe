let cafeMenu=0,cakes=1,shoppingCart=2,model={pages:["kafeMeny","kaker","handlevogn"],app:{currentPageIndex:cafeMenu,selectedProduct:null},inputs:{cafeMenu:{tab:"baguette",quantity:1,message:""},themeCakeMenu:{selectedThemeId:1,theme:"",size:1,basePrice:250,message:"",quantity:1},cakeMenu:{type:"chocolate",size:8,basePrice:300,quantity:1,message:""},shoppingCart:{case:"Overview",customerName:"",contactNumber:"",pickUpSchedule:{date:"",time:""},products:[]}},sizeMultipliers:{8:1,12:1.5,16:2},flavors:["Vanilje","Sjokolade","Sitron","Jordbær"],categories:["baguette","canapes","coffee","cakes"],categoryTranslations:{0:"Baguette",1:"Snitter",2:"Kaffe",3:"Kaker"},themes:[{themeId:1,themeName:"Uten tema",basePrice:450,description:"Ingen dekorasjon. Enkel og elegant."},{themeId:2,themeName:"Bryllup",basePrice:550,description:"Perfekt for bryllupsfeiring, med elegante dekorasjoner."},{themeId:3,themeName:"Barnebursdag",basePrice:400,description:"En morsom kake for barnas bursdag, med fargerik pynt."},{themeId:4,themeName:"Bursdag voksen",basePrice:420,description:"En sofistikert kake for voksne bursdagsfeiringer."},{themeId:5,themeName:"Jubileum",basePrice:440,description:"Feir store milepæler med en spesiell jubileumskake."},{themeId:6,themeName:"Jul",basePrice:480,description:"En festlig kake for juletiden, pyntet med sesongens farger."},{themeId:7,themeName:"Halloween",basePrice:490,description:"Skummel og morsom kake for Halloween, med kreativ pynt."},{themeId:8,themeName:"Konfirmasjon",basePrice:430,description:"En elegant kake til konfirmasjonsfeiringer."},{themeId:9,themeName:"Valentin",basePrice:470,description:"En romantisk kake for Valentinsdag, pyntet med hjerter."}],themeImages:{1:"uten-tema.webp",2:"Bryllup.webp",3:"Barnebursdag.webp",4:"Bursdag voksen.webp",5:"Jubileum.webp",6:"Jul.webp",7:"Halloween.webp",8:"konfirmasjon.webp",9:"Valentin.webp"},products:[],orders:[{orderId:1,customerName:"Maria Nilsen",contactNumber:"87493827",status:"Ny",pickUpSchedule:{date:"2024-11-09",time:"10:30"},products:[{productId:14,productName:"Biff og løkbaguette",quantity:2,comment:"Ekstra løk"},{productId:24,productName:"Americano",quantity:2,comment:""}]},{orderId:2,customerName:"Thomas Andersen",contactNumber:"48292838",status:"Klar til henting",pickUpSchedule:{date:"2024-11-13",time:"14:00"},products:[{productId:49,productName:"Brownies",quantity:1,comment:"Ekstra nøtter"},{productId:26,productName:"Cortado",quantity:1,comment:"Vanlig melk"}]},{orderId:3,customerName:"Camilla Foss",contactNumber:"92736483",status:"Hentet",pickUpSchedule:{date:"2024-10-19",time:"10:45"},products:[{productId:17,productName:"Snitter med roastbiff",quantity:1,comment:""}]},{orderId:4,customerName:"Ola Nordmann",contactNumber:"38299283",status:"Ny",pickUpSchedule:{date:"2024-11-06",time:"12:00"},products:[{productId:9,productName:"Falafelbaguette",quantity:3,comment:"Ekstra tahinisaus"},{productId:37,productName:"Flat White",quantity:3,comment:"Laktosefri melk"}]},{orderId:5,customerName:"Lise Kristoffersen",contactNumber:"91827364",status:"Under arbeid",pickUpSchedule:{date:"2024-11-15",time:"10:00"},products:[{productId:12,productName:"Baguette med spekeskinke",quantity:2,comment:""},{productId:24,productName:"Americano",quantity:2,comment:""}]},{orderId:6,customerName:"Anders Hauge",contactNumber:"92736484",status:"Hentet",pickUpSchedule:{date:"2024-10-23",time:"15:30"},products:[{productId:22,productName:"Cappuccino",quantity:1,comment:""},{productId:4,productName:"Røkelaks og eggerørebaguette",quantity:1,comment:""}]},{orderId:7,customerName:"Erik Hansen",contactNumber:"23829382",status:"Ny",pickUpSchedule:{date:"2024-11-04",time:"10:15"},products:[{productId:5,productName:"Tunfiskbaguette",quantity:2,comment:"Ingen rødløk, takk"},{productId:38,productName:"Mocha",quantity:2,comment:"Ekstra sjokolade"}]},{orderId:8,customerName:"Marius Strand",contactNumber:"93827164",status:"Klar til henting",pickUpSchedule:{date:"2024-11-18",time:"15:30"},products:[{productId:27,productName:"Macchiato",quantity:2,comment:""},{productId:7,productName:"Kyllingbaguette",quantity:2,comment:""}]},{orderId:9,customerName:"Peter Larsen",contactNumber:"38392839",status:"Under arbeid",pickUpSchedule:{date:"2024-11-11",time:"13:15"},products:[{productId:34,productName:"Ostekake med bær",quantity:1,comment:"Tilpasset for glutenfri"}]},{orderId:10,customerName:"Fredrik Dahl",contactNumber:"91827366",status:"Hentet",pickUpSchedule:{date:"2024-10-25",time:"09:00"},products:[{productId:6,productName:"Ost og skinkebaguette",quantity:1,comment:""},{productId:23,productName:"Latte",quantity:1,comment:""}]},{orderId:11,customerName:"Hans Pettersen",contactNumber:"87499283",status:"Under arbeid",pickUpSchedule:{date:"2024-11-08",time:"09:45"},products:[{productId:33,productName:"Sjokoladekake",quantity:1,comment:"Gratulerer med dagen på toppen"}]},{orderId:12,customerName:"Sara Bjerke",contactNumber:"93827165",status:"Hentet",pickUpSchedule:{date:"2024-10-21",time:"14:15"},products:[{productId:39,productName:"Marmorkake",quantity:1,comment:""}]},{orderId:13,customerName:"Jonas Lie",contactNumber:"92736481",status:"Under arbeid",pickUpSchedule:{date:"2024-11-16",time:"14:30"},products:[{productId:35,productName:"Gulrotkake",quantity:1,comment:"Ingen nøtter"}]},{orderId:14,customerName:"Vilde Sørensen",contactNumber:"92736482",status:"Klar til henting",pickUpSchedule:{date:"2024-11-19",time:"11:20"},products:[{productId:34,productName:"Ostekake med bær",quantity:1,comment:"Ekstra bringebær"}]},{orderId:15,customerName:"Sofie Berg",contactNumber:"93847483",status:"Ny",pickUpSchedule:{date:"2024-11-14",time:"09:15"},products:[{productId:3,productName:"Vegetarbaguette",quantity:2,comment:"Ekstra avokado"},{productId:52,productName:"Makroner",quantity:1,comment:"Blandede smaker"}]},{orderId:16,customerName:"Elisabeth Moe",contactNumber:"91827365",status:"Klar til henting",pickUpSchedule:{date:"2024-11-17",time:"12:45"},products:[{productId:16,productName:"Assorterte snitter",quantity:1,comment:""}]},{orderId:17,customerName:"Ingrid Svendsen",contactNumber:"38374738",status:"Ny",pickUpSchedule:{date:"2024-11-12",time:"11:00"},products:[{productId:13,productName:"Egg- og rekebaguette",quantity:3,comment:"Uten majones"},{productId:23,productName:"Latte",quantity:3,comment:"Med havremelk"}]},{orderId:18,customerName:"Eirik Holmen",contactNumber:"91827367",status:"Hentet",pickUpSchedule:{date:"2024-10-18",time:"12:30"},products:[{productId:11,productName:"Capresebaguette",quantity:2,comment:"Ekstra basilikum"},{productId:25,productName:"Americano",quantity:2,comment:""}]},{orderId:19,customerName:"Anna Johansen",contactNumber:"48392783",status:"Under arbeid",pickUpSchedule:{date:"2024-11-05",time:"11:30"},products:[{productId:8,productName:"Brie og avokadobaguette",quantity:1,comment:"Ingen tomat"},{productId:22,productName:"Cappuccino",quantity:1,comment:"Med soyamelk"}]},{orderId:20,customerName:"Kari Olsen",contactNumber:"43289283",status:"Klar til henting",pickUpSchedule:{date:"2024-11-07",time:"14:45"},products:[{productId:50,productName:"Sjokolademousse",quantity:5,comment:"Pyntet med friske bær"}]}],calculateCustomCakePrice(t,e){var a=this.themes.find(e=>e.themeId===t);return(a?a.basePrice:250)*(this.sizeMultipliers[e]||1)},calculateStandardCakePrice(t,e){var a=this.products.find(e=>e.productId===t);return(a?a.unitPrice:200)*(this.sizeMultipliers[e]||1)},subtractOrderedQuantityFromUnitsInStock(e){for(var t of this.products)for(var a of e)t.productId===a.productId&&(t.unitsInStock-=a.quantity)},addCustomQuantity(t,e){var a=this.products.find(e=>e.productId===t);if(!a)throw new Error("Produkt ikke funnet");a.unitsInStock+=e,saveModel()},submitOrder(e){let t=0;for(let e of this.orders)e.orderId>t&&(t=e.orderId+1);e.orderId=t,e.status="Ny",this.orders.push(e),this.subtractOrderedQuantityFromUnitsInStock(e.products),saveModel()},updateOrderStatus(t,e){var a=this.orders.find(e=>e.orderId===t);a&&(a.status=e),saveModel()},updateProductStock(t,e){var a=this.products.find(e=>e.productId===t);a?(a.unitsInStock=parseInt(e,10),saveModel(),console.log(`Oppdatert lagerbeholdning for "${a.productName}" til `+a.unitsInStock)):console.error(`Produkt med ID ${t} ikke funnet.`)},updateProductDetails(t,e){var a=this.products.find(e=>e.productId===t);a?(void 0!==e.unitsInStock&&(a.unitsInStock=parseInt(e.unitsInStock,10)),void 0!==e.description&&(a.description=e.description),saveModel(),console.log(`Oppdatert detaljer for "${a.productName}"`)):console.error(`Produkt med ID ${t} ikke funnet.`)},replaceModel(e){for(var t in this)Object.prototype.hasOwnProperty.call(e,t)&&(this[t]=e[t])}},localStorageModelName="model";function initiateModelLocalStorage(){var e=localStorage.getItem(localStorageModelName);e?(e=JSON.parse(e),model.replaceModel(e)):getProducts()}function saveModel(){localStorage.setItem(localStorageModelName,JSON.stringify(model))}async function getProductsFromStore(){try{return await(await fetch("data/products.json")).json()}catch(e){return alert("Failed to load products from json file: ",e),[]}}async function getProducts(){model.products=await getProductsFromStore(),saveModel(),updateView()}function getProductsForCategory(e){var t,a=model.categories.indexOf(e),o=[];for(t of model.products)t.categoryIndex===a&&o.push(t);return o}function getProductFromId(t){return model.products.find(e=>e.productId===t)||null}function openProductInfo(e){model.app.selectedProduct=e,updateView()}function closeOverlay(){var e=model.app.selectedProduct;e&&"customizable"===e.type?(model.inputs.themeCakeMenu.size=8,model.inputs.themeCakeMenu.selectedThemeId=1,model.inputs.themeCakeMenu.selectedFlavor="Vanilje",model.inputs.themeCakeMenu.quantity=1):e&&(model.inputs.cakeMenu.size=8,model.inputs.cakeMenu.quantity=1),model.app.selectedProduct=null,model.inputs.cafeMenu.message="",model.inputs.cafeMenu.quantity=1,model.inputs.cakeMenu.size=8,model.inputs.cakeMenu.quantity=1,model.inputs.cakeMenu.message="",updateView()}function getProductsForCurrentPage(){return model.app.currentPageIndex===cafeMenu?getProductsForCurrentTab():model.app.currentPageIndex===cakes?getProductsForCategory("cakes"):void 0}function safeText(e){return DOMPurify.sanitize(e).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/"/g,"&quot;")}function hamburger(){document.getElementById("hamburger-menu").addEventListener("click",function(){document.querySelector("#header-container").classList.toggle("is-active")}),document.querySelectorAll(".header__nav button").forEach(e=>{e.addEventListener("click",function(){document.querySelector("#header-container").classList.remove("is-active")})})}function formatDateTime(e,t){var[e,a,o]=e.split("-");return o+`-${a}-${e} `+t}function createCafeMenuHtml(){var e=document.createElement("div"),t=(e.id="cafe-menu",e.innerHTML=createTabRowHtml()+createCafeProductsHtml(),createCafeProductInfoOverlayElement());return t&&e.appendChild(t),e}function createTabRowHtml(){var e=model.inputs.cafeMenu.tab;return`
    <h1 class="page__title">Velkommen til vår koselige kafé!</h1>
    <p class="menu-introduction">Klar for noe digg? Dykk inn i vårt utvalg av deilige baguetter, knallgode snitter og toppkaffe. Perfekt for en velfortjent pause eller en hyggelig prat. Finn din nye smakfavoritt eller en herlig smakbit å kose deg med!</p>
    <div id="cafe-menu-tab-row">
      <button onclick="switchTab('baguette')" class='${"baguette"===e?"selected-tab":"tab-button"}'>Baguetter</button>
      <button onclick="switchTab('canapes')" id='middle-tab-button' class='${"canapes"===e?"selected-tab":"tab-button"}'>Snitter</button>
      <button onclick="switchTab('coffee')" class='${"coffee"===e?"selected-tab":"tab-button"}'>Kaffe</button>
    </div>
  `}function getProductsForCurrentTab(){return getProductsForCategory(model.inputs.cafeMenu.tab)}function createCafeProductsHtml(){var e;let t="";for(e of getProductsForCurrentPage())t+=createCafeProductCardHtml(e);return`
    <div id='cards-grid-container'>
      <div id='cards-grid'>${t}</div>
    </div>
  `}function createCafeProductCardHtml(e){var t=0===e.unitsInStock;return`
    <article class="product-card ${t?"product-card--inactive":""}">
      <header class="product-card__header" ${t?"":`onclick="openProductInfo(${e.productId})"`}>
        <img class="product-card__image" src="./img/cafe_menu/${e.image}" alt="${e.productName}" width="300" height="300">
        <h2 class="product-card__title">${e.productName}</h2>
      </header>
      <footer class="product-card__footer">
        <div class="product-card__price">${e.unitPrice} Kr</div>
        <button class="product-card__button-add button__add-to-cart"
                onclick="addCafeProductToCart(${e.productId})"
                ${t?"disabled":""}>
          <svg class="cart-icon" fill="currentColor" height="20px" width="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 487.1 487.1" xml:space="preserve">
            <path d="M342.3,137.978H385l-63.3-108.6c-5.1-8.8-16.4-11.8-25.2-6.6c-8.8,5.1-11.8,16.4-6.6,25.2L342.3,137.978z" />
            <path d="M197.4,47.978c5.1-8.8,2.2-20.1-6.6-25.2s-20.1-2.2-25.2,6.6l-63.3,108.7H145L197.4,47.978z" />
            <path d="M455.7,171.278H31.3c-17.3,0-31.3,14-31.3,31.3v34.7c0,17.3,14,31.3,31.3,31.3h9.8l30.2,163.7
              c3.8,19.3,21.4,34.6,39.7,34.6h12h78.8c8,0,18.4,0,29,0l0,0h9.6h9.6l0,0c10.6,0,21,0,29,0h78.8h12c18.3,0,35.9-15.3,39.7-34.6
              l30.4-163.8h15.9c17.3,0,31.3-14,31.3-31.3v-34.7C487,185.278,473,171.278,455.7,171.278z M172.8,334.878v70.6
              c0,10.1-8.2,17.7-17.7,17.7c-10.1,0-17.7-8.2-17.7-17.7v-29.6v-69.4c0-10.1,8.2-17.7,17.7-17.7c10.1,0,17.7,8.2,17.7,17.7V334.878
              z M229.6,334.878v70.6c0,10.1-8.2,17.7-17.7,17.7c-10.1,0-17.7-8.2-17.7-17.7v-29.6v-69.4c0-10.1,8.2-17.7,17.7-17.7
              s17.7,8.2,17.7,17.7V334.878z M286.7,375.878v29.6c0,9.5-7.6,17.7-17.7,17.7c-9.5,0-17.7-7.6-17.7-17.7v-70.6v-28.4
              c0-9.5,8.2-17.7,17.7-17.7s17.7,7.6,17.7,17.7V375.878z M343.5,375.878v29.6c0,9.5-7.6,17.7-17.7,17.7c-9.5,0-17.7-7.6-17.7-17.7
              v-70.6v-28.4c0-9.5,7.6-17.7,17.7-17.7c9.5,0,17.7,7.6,17.7,17.7V375.878z" />
          </svg>
          ${t?"Utsolgt":"Legg til"}
        </button>
      </footer>
    </article>
  `}function createCafeProductInfoOverlayElement(){var e=getProductFromId(model.app.selectedProduct);if(null==e)return null;{let t=document.createElement("section");return t.classList.add("overlay"),t.innerHTML=`
      <section class="overlay__content">
        <header class="overlay-header">
          <h2 class="overlay__title">${e.productName}</h2>
          <button class="overlay-close-button" aria-label="Lukk" onclick="closeOverlay()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </header>

        <div class="overlay__body">
          <img src='./img/cafe_menu/${e.image}' alt="${e.productName}" class="overlay__image" width="521" height="400">
          <p class="overlay__price">${e.unitPrice?e.unitPrice+" Kr":"Pris ikke tilgjengelig"}</p>
          <p class="overlay__description">${e.description}</p>

          <div class="overlay__section overlay__section--comment">
            <label for="product-comment" class="overlay__label">Tilpasninger:</label>
            <textarea id="product-comment" class="overlay__textarea" placeholder="Skriv inn eventuelle tilpasninger her..." oninput='updateCafeProductComment(this.value)'></textarea>
          </div>
        </div>

        <footer class="overlay-footer">
          <div class="overlay__quantity">
            <label for="quantity-input" class="overlay__label">Antall:</label>
            <input type="number" value="1" min="1" id="quantity-input" class="overlay__quantity-input" oninput="model.inputs.cafeMenu.quantity=this.valueAsNumber"/>
          </div>
          <button id="overlay-buy" class="overlay-button"
            onclick="addCafeProductToCart(${e.productId})">
            Legg til i handlekurv
          </button>
        </footer>
      </section
    `,t.addEventListener("click",e=>{e.target===t&&closeOverlay()}),t}}function createCakeMenuHtml(){var e=document.createElement("div"),t=(e.id="cakes",e.innerHTML=createCakeProductsHtml(),createCakeProductInfoOverlayElement());return t&&e.appendChild(t),e}function createCakeProductsHtml(){var e;let t="";for(e of model.products.filter(e=>3===e.categoryIndex))t+=createCakeProductCardHtml(e);return`
<h1 class="page__title">Kaker for enhver anledning</h1>
<p class="menu-introduction">Uansett om du feirer en spesiell dag eller bare vil unne deg noe ekstra godt, har vi kaken for deg! Utforsk vårt utvalg av håndlagde kaker, fra klassiske smaker til kreative temakaker som passer til enhver anledning. La oss gjøre øyeblikkene dine enda søtere!</p>
<div class="order-notice">
    <p class="notice-message">Kaker må bestilles minst 7 dager før ønsket hentetid.</p>
</div>
    <div id='cards-grid-container'>
      <div id='cards-grid'>${t}</div>
    </div>
  `}function createCakeProductCardHtml(e){var t=0===e.unitsInStock;return`
    <article
      class="product-card ${t?"product-card--inactive":""}"
    >
      <header
        class="product-card__header"
        ${t?"":`onclick="openProductInfo(${e.productId})"`}
      >
        <img
          class="product-card__image"
          src="./img/cakes/${e.image}"
          alt="${e.productName}"
          width="300"
          height="300"
        />
        <h2 class="product-card__title">${e.productName}</h2>
      </header>
      <footer class="product-card__footer">
        ${"customizable"===e.type?`
            <div class="product-card__price">Fra 400 Kr</div>
            <button class="product-card__button-add button__add-to-cart" onclick="openProductInfo(${e.productId})">Tilpass</button>

                `:`
        <div class="product-card__price">${e.unitPrice} Kr</div>
            <button
          class="product-card__button-add button__add-to-cart"
          ${t?"disabled":""}
          ${t?"":`onclick="addCakeProductToCart(${e.productId})"`}
        >
          <svg
            class="cart-icon"
            fill="currentColor"
            height="20px"
            width="20px"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 487.1 487.1"
            xml:space="preserve"
          >
            <path
              d="M342.3,137.978H385l-63.3-108.6c-5.1-8.8-16.4-11.8-25.2-6.6c-8.8,5.1-11.8,16.4-6.6,25.2L342.3,137.978z"
            />
            <path
              d="M197.4,47.978c5.1-8.8,2.2-20.1-6.6-25.2s-20.1-2.2-25.2,6.6l-63.3,108.7H145L197.4,47.978z"
            />
            <path
              d="M455.7,171.278H31.3c-17.3,0-31.3,14-31.3,31.3v34.7c0,17.3,14,31.3,31.3,31.3h9.8l30.2,163.7
              c3.8,19.3,21.4,34.6,39.7,34.6h12h78.8c8,0,18.4,0,29,0l0,0h9.6h9.6l0,0c10.6,0,21,0,29,0h78.8h12c18.3,0,35.9-15.3,39.7-34.6
              l30.4-163.8h15.9c17.3,0,31.3-14,31.3-31.3v-34.7C487,185.278,473,171.278,455.7,171.278z M172.8,334.878v70.6
              c0,10.1-8.2,17.7-17.7,17.7c-10.1,0-17.7-8.2-17.7-17.7v-29.6v-69.4c0-10.1,8.2-17.7,17.7-17.7c10.1,0,17.7,8.2,17.7,17.7V334.878
              z M229.6,334.878v70.6c0,10.1-8.2,17.7-17.7,17.7c-10.1,0-17.7-8.2-17.7-17.7v-29.6v-69.4c0-10.1,8.2-17.7,17.7-17.7
              s17.7,8.2,17.7,17.7V334.878z M286.7,375.878v29.6c0,9.5-7.6,17.7-17.7,17.7c-9.5,0-17.7-7.6-17.7-17.7v-70.6v-28.4
              c0-9.5,8.2-17.7,17.7-17.7s17.7,7.6,17.7,17.7V375.878z M343.5,375.878v29.6c0,9.5-7.6,17.7-17.7,17.7c-9.5,0-17.7-7.6-17.7-17.7
              v-70.6v-28.4c0-9.5,7.6-17.7,17.7-17.7c9.5,0,17.7,7.6,17.7,17.7V375.878z"
            />
          </svg>
          ${t?"Utsolgt":"Legg til"}
        </button>
                `}
      </footer>
    </article>
  `}function createCakeProductInfoOverlayElement(){var e=getProductFromId(model.app.selectedProduct);if(null==e)return null;{var a="customizable"===(model.app.selectedProduct=e).type,o=a?model.themeImages[model.inputs.themeCakeMenu.selectedThemeId]:e.image,r=a?model.calculateCustomCakePrice(model.inputs.themeCakeMenu.selectedThemeId,model.inputs.themeCakeMenu.size):model.calculateStandardCakePrice(e.productId,model.inputs.cakeMenu.size);let t=document.createElement("section");return t.classList.add("overlay"),t.innerHTML=`
      <div class="overlay__content">
        <header class="overlay__header">
          <h2 class="overlay__title">${e.productName}</h2>
          <button class="overlay-close-button" aria-label="Lukk" onclick="closeOverlay()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </header>
        <div class="overlay__body">

          <img id="cakeImage" src="./img/cakes/${o}" alt="${e.productName}" class="overlay__image" width="521" height="400">
          <p class="overlay__price" id="cakePrice">${r} Kr</p>
          <p id="productDescription">${e.description}</p>
          ${a?`
          <div class="overlay__row">
            <!-- Theme selection -->
            <div class="overlay__section overlay__section--half">
              <label for="themeSelect" class="overlay__themeLabel">Velg tema:</label>
              <select id="themeSelect" class="overlay__themeSelect" onchange="updateTheme(this.value)">
                ${model.themes.map(e=>`
                  <option value="${e.themeId}" ${e.themeId===model.inputs.themeCakeMenu.selectedThemeId?"selected":""}>
                    ${e.themeName}
                  </option>
                `).join("")}
              </select>
            </div>

            <div class="overlay__section overlay__section--half">
              <label for="sizeSelect" class="overlay__sizeLabel">Velg størrelse:</label>
              <select id="sizeSelect" class="overlay__sizeSelect" onchange="updateCakeSize(this.value)">
                <option value="8" ${8===model.inputs.themeCakeMenu.size?"selected":""}>Liten (8 pax)</option>
                <option value="12" ${12===model.inputs.themeCakeMenu.size?"selected":""}>Medium (12 pax)</option>
                <option value="16" ${16===model.inputs.themeCakeMenu.size?"selected":""}>Stor (16 pax)</option>
              </select>
            </div>
          </div>
              `:`
          <div class="overlay__section">
            <label for="sizeSelect" class="overlay__sizeLabel">Velg størrelse:</label>
            <select id="sizeSelect" class="overlay__sizeSelect" onchange="updateCakeSize(this.value)">
              <option value="8" ${8===model.inputs.cakeMenu.size?"selected":""}>Liten (8 pax)</option>
              <option value="12" ${12===model.inputs.cakeMenu.size?"selected":""}>Medium (12 pax)</option>
              <option value="16" ${16===model.inputs.cakeMenu.size?"selected":""}>Stor (16 pax)</option>
            </select>
          </div>
              `}
         ${a?`
          <div class="overlay__section"><label for="flavorSelect" class="overlay__flavorLabel">Velg smak:</label>
          <select id="flavorSelect" class="overlay__flavorSelect" onchange="updateFlavor(this.value)">
            ${model.flavors.map(e=>`
              <option value="${e}" ${e===model.inputs.themeCakeMenu.selectedFlavor?"selected":""}>
                ${e}
              </option>
            `).join("")}
          </select></div>
          `:""}

          <div class="overlay__section overlay__section--comment">
            <label for="product-comment" class="overlay__label">Tilpasninger:</label>
            <textarea id="product-comment" class="overlay__textarea" placeholder="Skriv inn eventuelle tilpasninger her..." oninput="updateCakeProductComment(this.value)">${a?model.inputs.themeCakeMenu.message:""}</textarea>
          </div>

          <footer class="overlay-footer">
            <div class="overlay__quantity">
              <label for="quantityInput" class="overlay__label">Antall:</label>
              <input type="number" id="quantityInput" class="overlay__quantity-input" value="${(a?model.inputs.themeCakeMenu:model.inputs.cakeMenu).quantity}" min="1" oninput="model.inputs.${a?"themeCakeMenu":"cakeMenu"}.quantity = this.valueAsNumber" />
            </div>
            <button id="overlay-buy" class="overlay-button" onclick="addCakeProductToCart(${e.productId})">Legg til i handlekurv</button>
          </footer>

        </div>
      </div>
    `,t.addEventListener("click",e=>{e.target===t&&closeOverlay()}),t}}function updateView(){var e,t=document.getElementById("app"),a=createCurrentPageHtml(),o=model.pages[model.app.currentPageIndex];a instanceof HTMLElement?t.replaceChildren(a):((e=document.createElement("div")).innerHTML=a,t.replaceChildren(e)),model.pages.includes(o)?history.pushState({page:o},"","#"+o):console.error("Invalid page index:",o)}function createCurrentPageHtml(){return model.app.currentPageIndex===cafeMenu?createCafeMenuHtml():model.app.currentPageIndex===cakes?createCakeMenuHtml():model.app.currentPageIndex===shoppingCart?("Overview"!==model.inputs.shoppingCart.case?createCheckoutView:createShoppingCartHtml)():""}function switchMenu(e){model.app.currentPageIndex=e,updateView()}function switchTab(e){model.inputs.cafeMenu.tab=e,updateView()}function updateCafeProductComment(e){model.inputs.cafeMenu.message=e}function addCafeProductToCart(e){var t,a,e=getProductFromId(e);e?(t=null!=model.app.selectedProduct?model.inputs.cafeMenu.quantity:1,a=model.inputs.cafeMenu.message,addToCart(e.productName,e.unitPrice,e.productId,t,a),closeOverlay(),updateView()):console.error("Produktet ble ikke funnet.")}function updateCakeSize(e){var t=model.app.selectedProduct,a=document.getElementById("selectedSize");a&&(a.innerText="Size: "+e);let o;updatePriceDisplay(o="customizable"===t.type?(model.inputs.themeCakeMenu.size=parseInt(e),o=model.calculateCustomCakePrice(model.inputs.themeCakeMenu.selectedThemeId,model.inputs.themeCakeMenu.size),model.calculateCustomCakePrice(model.inputs.themeCakeMenu.selectedThemeId,model.inputs.themeCakeMenu.size)):(model.inputs.cakeMenu.size=parseInt(e),o=model.calculateStandardCakePrice(t.productId,model.inputs.cakeMenu.size),model.calculateStandardCakePrice(t.productId,model.inputs.cakeMenu.size)))}function updateTheme(e){model.inputs.themeCakeMenu.selectedThemeId=parseInt(e);updatePriceDisplay(model.calculateCustomCakePrice(model.inputs.themeCakeMenu.selectedThemeId,model.inputs.themeCakeMenu.size));var e=model.themeImages[e],t=document.getElementById("cakeImage");t&&(t.src="./img/cakes/"+e)}function updatePriceDisplay(e){var t=document.getElementById("cakePrice");t&&(t.innerText=e+" Kr")}function updateFlavor(e){model.inputs.themeCakeMenu.selectedFlavor=e}function addCakeProductToCart(t){var a=getProductFromId(t);if(a){var o,r="customizable"===a.type,n=(!r||model.inputs.themeCakeMenu.size&&1!==model.inputs.themeCakeMenu.size?r||model.inputs.cakeMenu.size&&1!==model.inputs.cakeMenu.size||(model.inputs.cakeMenu.size=8):model.inputs.themeCakeMenu.size=8,(r?model.inputs.themeCakeMenu:model.inputs.cakeMenu).quantity),i=r?model.calculateCustomCakePrice(model.inputs.themeCakeMenu.selectedThemeId,model.inputs.themeCakeMenu.size):model.calculateStandardCakePrice(t,model.inputs.cakeMenu.size),c=model.inputs.cakeMenu.message;let e=a.productName;r?(r=(a=model.themes.find(e=>e.themeId===model.inputs.themeCakeMenu.selectedThemeId))?" - "+a.themeName:"",a=` (${model.inputs.themeCakeMenu.size} personer)`,o=model.inputs.themeCakeMenu.selectedFlavor||"Vanilje",e+=r+" - "+o+a):(r=` (${model.inputs.cakeMenu.size} personer)`,e+=r),addToCart(e,i,t,n,c),closeOverlay()}}function updateCakeProductComment(e){model.inputs.cakeMenu.message=e}function createShoppingCartHtml(){var e=document.createElement("div");return e.id="cart",e.classList.add("cart"),e.innerHTML=`
      <div class="cart-content">
          <div class="cart-header">
              <h1>Handlekurv</h1>
              <button id="clearCartButton" onclick="clearCart()">Tøm handlekurven</button>
          </div>
          <div class="cart-items" id="cartItems">
            ${createCartItemsHtml()}
          </div>
          <div class="cart-total-container">
              <p>Totalt: &nbsp;</p>
              <span id="cartTotal">${getSumOfAllItemsInCart()}</span>&nbsp; kr
          </div>
          <button id="checkoutButton"
                  onclick="goToPickupTime()"
                  ${0===getCartItems().length?"disabled":""}>
              Til kassen
          </button>
      </div>
  `,e}function renderCart(){let r=document.getElementById("cartItems");var e=document.getElementById("cartCount"),t=document.getElementById("cartTotal"),n=document.getElementById("checkoutButton"),i=getCartItems();if(r){r.innerHTML="";let a=0,o=0;i.forEach((e,t)=>{r.innerHTML+=createCartItemHtml(t,e),a+=e.price*e.quantity,o+=e.quantity}),e&&(e.textContent=o),t&&(t.textContent=a),n&&(n.disabled=0===o)}}function createCartItemsHtml(){let a="";return model.inputs.shoppingCart.products.forEach((e,t)=>{a+=createCartItemHtml(t,e)}),a}function createCartItemHtml(e,t){var a=t.price*t.quantity;return`
    <div class="cart-item">
        <div class="cart-item-info">
            <div class="cart-item-name"><strong>${t.name}</strong></div>
        </div>
        <div class="cart-item-message">
          <label for="cart-item-message-input-${e}">Tilpasninger:</label>
          <textarea id='cart-item-message-input-${e}' value='${t.message}' onchange="setCartItemMessage(${e}, this.value)">${t.message}</textarea>
        </div>
        <div class="cart-item-aligned-right">
          <div class="cart-item-price">${t.price} Kr</div>
          <div class="cart-item-quantity-container">
            <label for="cart-item-input-${e}">Antall:</label>
            <input id="cart-item-input-${e}" type="number" min=1 class="cart-item-quantity" value=${t.quantity} onchange="setCartItemQuantity(${e}, this.valueAsNumber)">
          </div>
          <div class="cart-item-total">Totalt ${a} Kr</div>
          <button class="remove-btn" onclick="removeFromCart(${e})">Fjern</button>
        </div>
    </div>
  `}function showCartNotification(e){let t=document.getElementById("cartNotification");t&&(t.textContent=e,t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},3e3))}function updateCartButtonView(){let e=document.getElementById("cartLink");document.getElementById("cartCount").innerText=getNrOfItemsInCart(),e&&(e.classList.add("bounce","pulse"),setTimeout(()=>{e.classList.remove("bounce","pulse")},600))}function updateCartView(){}function addToCart(t,e,a,o=1,r){var n=model.inputs.shoppingCart.products,i=n.find(e=>e.name===t);i?(i.quantity+=o,i.message+=r):n.push({name:t,price:e,quantity:o,productId:a,message:r}),updateCartButtonView(),showCartNotification("Produkt lagt til i handlekurv")}function setCartItemMessage(e,t){model.inputs.shoppingCart.products[e].message=t}function removeFromCart(e){model.inputs.shoppingCart.products.splice(e,1),updateView(),updateCartButtonView(),showCartNotification("Produkt fjernet fra handlevogn")}function clearCart(){model.inputs.shoppingCart.products=[],updateView(),updateCartButtonView(),showCartNotification("Handlevognen er nå tom")}function setCartItemQuantity(e,t){(t<=0||isNaN(t))&&(t=1),model.inputs.shoppingCart.products[e].quantity=t,updateView(),updateCartButtonView()}function showShoppingCart(){model.app.currentPageIndex=shoppingCart,model.inputs.shoppingCart.case="Overview",updateView()}function getCartItems(){return model.inputs.shoppingCart.products}function getNrOfItemsInCart(){return model.inputs.shoppingCart.products.reduce((e,t)=>e+t.quantity,0)}function getSumOfAllItemsInCart(){return model.inputs.shoppingCart.products.reduce((e,t)=>e+t.quantity*t.price,0)}function goToPickupTime(){console.log("Going to pickup time"),model.inputs.shoppingCart.case="PickupTime",updateView()}function updatePickupDate(e){console.log("Updating pickup date:",e),model.inputs.shoppingCart.pickUpSchedule.date=e}function updatePickupTime(e){console.log("Updating pickup time:",e),model.inputs.shoppingCart.pickUpSchedule.time=e}function updateCustomerName(e){console.log("Updating customer name:",e),model.inputs.shoppingCart.customerName=e}function updateContactNumber(e){console.log("Updating contact number:",e),model.inputs.shoppingCart.contactNumber=e}function goToCustomerInfo(){var e=model.inputs.shoppingCart.pickUpSchedule.date,t=model.inputs.shoppingCart.pickUpSchedule.time;e&&t?(model.inputs.shoppingCart.case="NameAndNumber",updateView()):alert("Vennligst velg både dato og tid for henting")}function submitOrder(){var e,{customerName:t,contactNumber:a}=model.inputs.shoppingCart;t&&a?isValidPhoneNumber(a)?(e=getCartItems().map(e=>({productId:e.productId,productName:e.name,quantity:e.quantity,comment:e.message||""})),t={orderId:model.orders.length+1,customerName:t,contactNumber:a,status:"Ny",pickUpSchedule:{...model.inputs.shoppingCart.pickUpSchedule},products:e},model.orders.push(t),model.subtractOrderedQuantityFromUnitsInStock(e),saveModel(),clearCart(),model.inputs.shoppingCart.case="OrderSent",updateView()):alert("Vennligst skriv inn et gyldig telefonnummer"):alert("Vennligst fyll ut både navn og telefonnummer")}function isValidPhoneNumber(e){e=e.replace(/\s/g,"");return/^(\+47)?\d{8}$/.test(e)}function createCheckoutView(){var e=document.createElement("div");switch(model.inputs.shoppingCart.case){case"PickupTime":e.innerHTML=createPickupTimeView();break;case"NameAndNumber":e.innerHTML=createCustomerInfoView();break;case"OrderSent":e.innerHTML=createOrderConfirmation();break;default:return createCartOverview()}return e}function generateTimeOptions(){let t="";for(let e=8;e<16;e++){var a=e.toString().padStart(2,"0")+":00";t+=`<option value="${a}">${a}</option>`,15!==e&&(a=e.toString().padStart(2,"0")+":30",t+=`<option value="${a}">${a}</option>`)}return t}function createPickupTimeView(){var e=dayjs(),t=e.add(14,"day");return`
    <div class="checkout-container">
      <h2>Velg hentetidspunkt</h2>

      <div class="date-picker-container">
        <label for="pickup-date">Dato:</label>
        <input
          type="date"
          id="pickup-date"
          min="${e.format("YYYY-MM-DD")}"
          max="${t.format("YYYY-MM-DD")}"
          onchange="updatePickupDate(this.value)"
        />
      </div>

      <div class="time-picker-container">
        <label for="pickup-time">Tid:</label>
        <select id="pickup-time" onchange="updatePickupTime(this.value)">
          <option value="">Velg tid</option>
          ${generateTimeOptions()}
        </select>
      </div>

      <div class="button-row">
        <button
          onclick="model.inputs.shoppingCart.case='Overview'; updateView();"
        >
          Tilbake
        </button>
        <button onclick="goToCustomerInfo()">Neste</button>
      </div>
    </div>
  `}function createCustomerInfoView(){return`
    <div class="checkout-container">
      <h2>Dine opplysninger</h2>

      <div class="form-group">
        <label for="customer-name">Navn:</label>
        <input
          type="text"
          id="customer-name"
          required
          oninput="updateCustomerName(this.value)"
          value="${model.inputs.shoppingCart.customerName}"
        />
      </div>

      <div class="form-group">
        <label for="contact-number">Telefonnummer:</label>
        <input
          type="tel"
          id="contact-number"
          required
          placeholder="12345678"
          oninput="updateContactNumber(this.value)"
          value="${model.inputs.shoppingCart.contactNumber}"
        />
      </div>

      <div class="order-summary">
        <h3>Din bestilling vil være klar:</h3>
        <p>
          ${dayjs(model.inputs.shoppingCart.pickUpSchedule.date).format("DD. MMMM YYYY")}
          kl. ${model.inputs.shoppingCart.pickUpSchedule.time}
        </p>
      </div>

      <div class="button-row">
        <button
          onclick="model.inputs.shoppingCart.case='PickupTime'; updateView();"
        >
          Tilbake
        </button>
        <button onclick="submitOrder()">Send bestilling</button>
      </div>
    </div>
  `}function createOrderConfirmation(){var e=model.orders[model.orders.length-1];return`
    <div class="checkout-container">
      <h2>Takk for din bestilling!</h2>

      <div class="confirmation-details">
        <p>
          Vi har mottatt din bestilling med bestillings-ID:
          ${e.orderId}
        </p>
        <p>Din bestilling vil være klar til henting:</p>
        <p class="pickup-time">
          ${dayjs(e.pickUpSchedule.date).format("DD. MMMM YYYY")} kl.
          ${e.pickUpSchedule.time}
        </p>

        <p>En ansatt vil snart bekrefte bestillingen din via SMS.</p>
      </div>

      <button onclick="window.location.href='index.html#kafeMeny';">
        Tilbake til meny
      </button>
    </div>
  `}function clearLocalStorage(){localStorage.clear(),alert('"Local storage" har blitt tømt!'),location.reload()}window.addEventListener("popstate",e=>{e.state&&e.state.page&&(model.app.currentPageIndex=model.pages.indexOf(e.state.page),document.getElementById("app").replaceChildren(createCurrentPageHtml()))}),window.addEventListener("DOMContentLoaded",()=>{var e=window.location.hash.substring(1),e=model.pages.indexOf(e);model.app.currentPageIndex=-1!==e?e:cafeMenu,updateView()}),window.addCafeProductToCart=addCafeProductToCart,window.showCartNotification=showCartNotification,console.log("cartView.js loaded"),window.addToCart=addToCart,window.removeFromCart=removeFromCart,window.clearCart=clearCart,window.showShoppingCart=showShoppingCart,window.getCartItems=getCartItems,console.log("cartController.js loaded"),window.goToPickupTime=goToPickupTime,window.updatePickupDate=updatePickupDate,window.updatePickupTime=updatePickupTime,window.updateCustomerName=updateCustomerName,window.updateContactNumber=updateContactNumber,window.goToCustomerInfo=goToCustomerInfo,window.submitOrder=submitOrder,console.log("checkoutController.js loaded. Functions available:",{goToPickupTime:typeof window.goToPickupTime,updatePickupDate:typeof window.updatePickupDate,updatePickupTime:typeof window.updatePickupTime,updateCustomerName:typeof window.updateCustomerName,updateContactNumber:typeof window.updateContactNumber}),window.generateTimeOptions=generateTimeOptions,console.log("checkoutView.js loaded");